<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Class Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Styles -->
  <link rel="stylesheet" href="/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
  <div class="container-fluid vh-100">
    <div class="row h-100">
      <!-- Sidebar -->
      <%- include('./partials/sidenav') %>

      <!-- Main Content -->
      <div class="col-md-10 bg-white">
        <div class="container mt-3">
          <div class="d-flex justify-content-between align-items-center">
            <a href="/admin/classes" class="btn btn-outline-primary btn-sm">Back</a>
            <button class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#editClassModal">
              Edit
            </button>
          </div>

          <%- include('../partials/messages') %>

          <div class="row">
            <div class="col-md-4">
              <div class="mt-5 p-4 border rounded shadow-sm bg-light">
                <h3 class="mb-3"><%= singleClass.title %></h3>

                <div class="mb-3">
                  <strong>Description:</strong>
                  <p class="text-muted"><%= singleClass.description || 'No description provided.' %></p>
                </div>

                <div class="mb-3">
                  <strong>Created By:</strong>
                  <p class="text-muted"><%= singleClass.crated_by %></p>
                </div>

                <div class="mb-3">
                  <strong>Status:</strong>
                  <span class="badge <%= singleClass.status ? 'bg-success' : 'bg-secondary' %>">
                    <%= singleClass.status ? 'Active' : 'Inactive' %>
                  </span>
                </div>
              </div>
            </div>
             <div class="col-md-4">
              <div class="mt-5 p-4 border rounded shadow-sm bg-light">

                <div class="mb-3">
                  <strong>Scheduled Time:</strong>
                  <p class="text-muted"><%= new Date(singleClass.scheduled_at).toLocaleString() %></p>
                </div>

                <div class="mb-3">
                  <strong>Meet Link:</strong>
                  <p><a href="<%= singleClass.meet_link %>" target="_blank" class="text-decoration-underline"><%= singleClass.meet_link %></a></p>
                </div>

            <div class="mb-3">
                <strong>Show Link:</strong>
                <p><%= singleClass.show_link %></p>

                <form action="/admin/class/<%= singleClass.id %>/<%= singleClass.show_link ? 'false' : 'true' %>" method="post">
                  <input type="hidden" name="_method" value="PUT">
                  <div class="form-check form-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="toggleShowLink"
                      onchange="this.form.submit()"
                      <%= singleClass.show_link ? 'checked' : '' %>
                    >
                    <label class="form-check-label" for="toggleShowLink">
                      Toggle Show Link
                    </label>
                  </div>
                </form>
              </div>



                <div class="mb-3">
                  <strong>Join Code:</strong>
                  <p class="text-muted"><%= singleClass.join_code || 'Not available' %></p>
                </div>

         
              </div>
            </div>

            <div class="col-md-4">
              <div class="attendance-section mt-4 mb-5">
              <h5>Class Attendance</h5>

              <% if (attendance.length === 0) { %>
                <p class="text-muted">No user has signed into this class yet.</p>
              <% } else { %>
                <ul class="list-group">
                  <% attendance.forEach(function(user) { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <strong><%= user.full_name || 'Unnamed' %></strong><br>
                        <small><%= user.email %></small><br>
                        <small class="text-muted">
                          Joined at: 
                          <%= new Date(user.joined_at).toLocaleString('en-US', {
                            year: 'numeric', month: 'short', day: 'numeric',
                            hour: '2-digit', minute: '2-digit'
                          }) %>
                        </small>
                      </div>

                      <p><%= user.status %></p>
                    <form action="/admin/class/<%= singleClass.id %>/grant-access/<%= user.id %>" method="post" class="d-flex align-items-center">
                        <input type="hidden" name="_method" value="PUT">
                        
                        <input 
                          type="checkbox" 
                          name="granted" 
                          onchange="this.form.submit()" 
                          id="accessGranted_<%= user.id %>" 
                          <%= user.status ? 'checked' : '' %> 
                        >
                        
                        <label for="accessGranted_<%= user.id %>" class="ms-2 mb-0">Access Granted</label>
                      </form>
                    </li>
                  <% }); %>
                </ul>
              <% } %>
            </div>

            </div>
          </div>
         

      


        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editClassModal" tabindex="-1" aria-labelledby="editClassModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" method="post" action="/admin/class/<%= singleClass.id %>/edit">
           <input type="hidden" name="_method" value="PUT">
          <div class="modal-header">
            <h5 class="modal-title">Edit Class Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="classTitle" class="form-label">Class Title</label>
              <input type="text" class="form-control" id="classTitle" name="title" value="<%= singleClass.title %>" required>
            </div>

            <div class="mb-3">
              <label for="classDesc" class="form-label">Description</label>
              <textarea class="form-control" id="classDesc" name="description" rows="3" required><%= singleClass.description %></textarea>
            </div>

            <div class="mb-3">
              <label for="scheduledAt" class="form-label">Scheduled Date & Time</label>
              <input type="datetime-local" class="form-control" id="scheduledAt" name="scheduled_at"
                     value="<%= new Date(singleClass.scheduled_at).toISOString().slice(0, 16) %>" required>
            </div>

            <div class="mb-3">
              <label for="meetLink" class="form-label">Meeting Link</label>
              <input type="url" class="form-control" id="meetLink" name="meet_link" value="<%= singleClass.meet_link %>">
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
           
            <input name="_method" type="submit" value="Save Changes" class="btn btn-primary "/>
             
          </div>

        </form>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
