<!-- Navbar -->
<%-include('./partials/topnav') %>

<!-- Sidebar -->
<%-include('./partials/sidenav') %>

<!-- Main Content -->
<div class="container-fluid mt-4">
 

  <div class="row">
    <!-- Static Sidebar for desktop -->
    <div class="col-lg-3 d-none d-lg-block">
      <%-include('./partials/staticsidebar') %>
    </div>

    <!-- Main Dashboard Section -->
    <div class="col-lg-9">
      <main class="p-0">
         <!-- Welcome Banner -->
            <div class="bg-grad text-center text-white rounded p-4 mb-4 shadow-sm">
              <div class="text-center">
                  <p>Home</p>
                    <hr>
                <p class="mb-0">Welcome <%= user.full_name %>!</p>
              </div>
            </div>
        <%- include('../partials/messages') %>

        
          <div class="mb-3">
            <p class="mb-3 text-success" style="font-size: 17px;">Free Courses </p>
            <div class="scroll-wrapper">
              <!-- Navigation buttons -->
              <button class="scroll-btn scroll-btn-left" onclick="scrollCourses(-1)">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="scroll-btn scroll-btn-right" onclick="scrollCourses(1)">
                <i class="fas fa-chevron-right"></i>
              </button>
              
              <div class="scroll-container" id="coursesContainer">
                <% freeCourses.forEach(course => { %>
                  <div class="course-card">
                    <img src="<%= course.image_url || '/images/thumbnail.png' %>" alt="<%= course.title %>">

                    <div class="card-overlay">
                      <div class="course-title text-warning"><%= course.title %></div>
                      <div class="course-meta">
                        <!-- <span><i class="fas fa-heart text-danger"></i> <%= course.like_count || 0 %></span> -->
                        <span><i class="fas fa-users text-light"></i> <%= (parseInt(course.enrolled_count) || 0) + 75 %></span>
                      </div>
                      <a href="/user/course/<%= course.id %>/details" class="btn view-button">View Course</a>
                    </div>
                  </div>
                <% }) %>

                <div class="course-card-button bg-grad">
                  <div class="text-warning">
                    <p>we have more</p>
                    <h1>Free Courses</h1>
                  </div>
                  <div class="course-meta">
                    <a href="/user/course/free" class="btn text-warning">Explore more</a>
                  </div>
                </div>
              </div>
            </div>
          </div>


        <div class="mb-4 card shadow-sm p-2">
          <p class="text-success mb-3"> TSA Categories</p>
           <div class="row">
             <%- include('../partials/courses') %>
           </div>

        </div>
      </main>


    </div>
  </div>
</div>


<script>
  const scrollContainer = document.getElementById('free-courses-scroll');
  const cards = scrollContainer.querySelectorAll('.course-card');

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        cards.forEach(card => card.classList.remove('focused'));
        entry.target.classList.add('focused');
      }
    });
  }, {
    root: scrollContainer,
    threshold: 0.5
  });

  cards.forEach(card => observer.observe(card));
</script>

<script>
  function scrollCourses(direction) {
    const container = document.getElementById('coursesContainer');
    const scrollAmount = 300; // Adjust this value as needed
    
    container.scrollBy({
      left: direction * scrollAmount,
      behavior: 'smooth'
    });
  }
  
  // Optional: Hide buttons when at the edges
  function updateButtonVisibility() {
    const container = document.getElementById('coursesContainer');
    const leftBtn = document.querySelector('.scroll-btn-left');
    const rightBtn = document.querySelector('.scroll-btn-right');
    
    // Show/hide left button
    if (container.scrollLeft <= 10) {
      leftBtn.style.opacity = '0.5';
      leftBtn.style.pointerEvents = 'none';
    } else {
      leftBtn.style.opacity = '1';
      leftBtn.style.pointerEvents = 'auto';
    }
    
    // Show/hide right button
    if (container.scrollLeft + container.clientWidth >= container.scrollWidth - 10) {
      rightBtn.style.opacity = '0.5';
      rightBtn.style.pointerEvents = 'none';
    } else {
      rightBtn.style.opacity = '1';
      rightBtn.style.pointerEvents = 'auto';
    }
  }
  
  // Initialize button visibility and add scroll event listener
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('coursesContainer');
    container.addEventListener('scroll', updateButtonVisibility);
    updateButtonVisibility();
  });
</script>