<!-- Navbar -->
<%-include('./partials/topnav') %>

<!-- Sidebar -->
<%-include('./partials/sidenav') %>

<!-- Main Content -->
<div class="min-h-screen bg-gray-50">
  <div class="container mx-auto px-4 py-6">
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Static Sidebar for Desktop -->
      <div class="hidden lg:block lg:w-1/4">
        <%-include('./partials/staticsidebar') %>
      </div>

      <!-- Main Content Area -->
      <div class="lg:w-3/4">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
          <a href="/user" 
             class="inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
            <i class="fas fa-arrow-left text-gray-600"></i>
            <span class="text-sm font-medium text-gray-700">Back to Dashboard</span>
          </a>
        </div>

        <%- include('../partials/messages') %>

        <!-- Free Courses Section -->
        <div class="mb-8">
          <% if (freeCourses && freeCourses.length > 0) { %>
            <!-- Section Header -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 mb-6 shadow-lg">
              <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                  <h1 class="text-2xl font-bold text-white mb-2">Free Programs</h1>
                  <p class="text-blue-100">Enroll in these free programs and start learning today</p>
                </div>
                <div class="flex items-center gap-3">
                  <span class="px-4 py-2 bg-white bg-opacity-20 text-dark rounded-full">
                    <i class="fas fa-gift mr-2"></i>
                    <%= freeCourses.length %> Free Programs
                  </span>
                </div>
              </div>
            </div>

               <!-- Stats Footer -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6 mb-4">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                  <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-50 mb-3">
                    <i class="fas fa-graduation-cap text-2xl text-blue-500"></i>
                  </div>
                  <h3 class="font-bold text-gray-900 mb-1"><%= freeCourses.length %> Free Programs</h3>
                  <p class="text-gray-600 text-sm">Available for enrollment</p>
                </div>
                
                <div class="text-center">
                  <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-50 mb-3">
                    <i class="fas fa-video text-2xl text-green-500"></i>
                  </div>
                  <h3 class="font-bold text-gray-900 mb-1">
                    <%= freeCourses.reduce((sum, course) => sum + (course.total_sessions || 0), 0) %> Classes
                  </h3>
                  <p class="text-gray-600 text-sm">Total learning sessions</p>
                </div>
                
                <div class="text-center">
                  <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-purple-50 mb-3">
                    <i class="fas fa-clock text-2xl text-purple-500"></i>
                  </div>
                  <h3 class="font-bold text-gray-900 mb-1">Lifetime Access</h3>
                  <p class="text-gray-600 text-sm">Learn at your own pace</p>
                </div>
              </div>
            </div>

            <!-- Free Courses Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <% freeCourses.forEach(function (data) { %>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 hover:shadow-xl transition-all duration-300">
                  <!-- Course Image -->
                  <div class="relative h-48 overflow-hidden">
                    <% if (data.image_url == "default.jpg") { %>
                      <img src="/images/thumbnail.png" 
                           alt="Program image" 
                           class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                    <% } else { %>
                      <img src="/uploads/<%= data.image_url %>" 
                           alt="Program image" 
                           class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                    <% } %>
                    
                    <!-- Free Badge -->
                    <div class="absolute top-4 left-4">
                      <span class="px-3 py-1 bg-green-500 text-white text-xs font-bold rounded-full">
                        <i class="fas fa-gift mr-1"></i>FREE
                      </span>
                    </div>
                    
                    <!-- Progress Badge -->
                    <% if (data.progress && data.progress > 0) { %>
                      <div class="absolute top-4 right-4">
                        <span class="px-3 py-1 bg-blue-500 text-white text-xs font-bold rounded-full">
                          <%= data.progress %>% Complete
                        </span>
                      </div>
                    <% } %>
                  </div>

                  <!-- Course Content -->
                  <div class="p-5">
                    <!-- Course Title & Description -->
                    <h3 class="font-bold text-gray-900 mb-2 line-clamp-1" title="<%= data.title %>">
                      <%= data.title %>
                    </h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2" title="<%= data.description %>">
                      <%= data.description %>
                    </p>

                    <!-- Course Stats -->
                    <div class="mb-4">
                      <!-- Sessions Count -->
                      <div class="flex items-center gap-2 mb-3">
                        <div class="flex items-center gap-1">
                          <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center">
                            <i class="fas fa-video text-blue-500 text-sm"></i>
                          </div>
                          <div>
                            <p class="text-xs text-gray-500">Total Classes</p>
                            <p class="text-sm font-semibold text-gray-900"><%= data.total_sessions || 0 %></p>
                          </div>
                        </div>
                        
                        <!-- Completed Sessions -->
                        <% if (data.completed_sessions && data.completed_sessions > 0) { %>
                          <div class="flex items-center gap-1">
                            <div class="w-8 h-8 rounded-full bg-green-50 flex items-center justify-center">
                              <i class="fas fa-check-circle text-green-500 text-sm"></i>
                            </div>
                            <div>
                              <p class="text-xs text-gray-500">Completed</p>
                              <p class="text-sm font-semibold text-gray-900"><%= data.completed_sessions || 0 %></p>
                            </div>
                          </div>
                        <% } %>
                      </div>

                      <!-- Progress Section -->
                      <div>
                        <!-- Progress Info -->
                        <div class="flex justify-between items-center mb-2">
                          <span class="text-xs font-medium text-gray-700">Your Progress</span>
                          <span class="text-xs font-bold text-blue-600"><%= data.progress || 0 %>%</span>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                          <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-300"
                               style="width: <%= data.progress || 0 %>%"></div>
                        </div>
                        
                        <!-- Progress Text -->
                        <div class="flex justify-between text-xs text-gray-500">
                          <span>
                            <i class="fas fa-play-circle mr-1"></i>
                            <%= data.completed_sessions || 0 %> of <%= data.total_sessions || 0 %> classes
                          </span>
                          <% if (data.progress && data.progress > 0) { %>
                            <span class="font-medium">
                              <%= Math.round((data.completed_sessions || 0) / (data.total_sessions || 1) * 100) %>%
                            </span>
                          <% } %>
                        </div>
                      </div>
                    </div>

                    <!-- Action Button -->
                    <div class="pt-4 border-t border-gray-100">
                      <a href="/user/course/<%= data.id %>/<%= data.category_id %>" 
                         class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-medium rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all shadow-sm">
                        <i class="fas fa-eye"></i>
                        <% if (data.progress && data.progress > 0) { %>
                          Continue Learning
                        <% } else { %>
                          View Program
                        <% } %>
                      </a>
                    </div>
                  </div>
                </div>
              <% }); %>
            </div>

         
          <% } else { %>
            <!-- Empty State -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
              <div class="text-center py-12">
                <div class="mb-6">
                  <div class="inline-flex items-center justify-center w-24 h-24 rounded-full bg-blue-50">
                    <i class="fas fa-gift text-4xl text-blue-400"></i>
                  </div>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">No Free Programs Available</h3>
                <p class="text-gray-600 mb-6 max-w-md mx-auto">
                  There are no free programs available at the moment. Please check back later or explore our paid programs.
                </p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                  <a href="/user" 
                     class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                  </a>
                  <a href="/user/category/all" 
                     class="inline-flex items-center gap-2 px-6 py-3 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                    <i class="fas fa-search"></i>
                    Browse All Programs
                  </a>
                </div>
              </div>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .line-clamp-1 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 1;
  }
  
  .line-clamp-2 {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }
  
  .hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
  
  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }
</style>

<script>
  // Add hover effects to course cards
  document.addEventListener('DOMContentLoaded', function() {
    const courseCards = document.querySelectorAll('.bg-white.rounded-xl');
    courseCards.forEach(card => {
      card.addEventListener('mouseenter', function() {
        this.classList.add('hover-lift');
      });
      
      card.addEventListener('mouseleave', function() {
        this.classList.remove('hover-lift');
      });
    });
    
    // Add animation for new elements
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-fadeIn');
        }
      });
    }, {
      threshold: 0.1
    });
    
    courseCards.forEach(card => observer.observe(card));
  });

  // Add CSS animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
  `;
  document.head.appendChild(style);
</script>